View(dat_top)
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique() %>%
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
.[10,]
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
.[10,]
View(dat_top)
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir)))
dat_top <- dat_top[10,]
View(dat_top)
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir)))
View(dat_top)
dat_top <- dat_top[1:10,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir)) +
geom_bar(stat = "identity") +
labs(title = "Importance", x = "Chem", y = "Sum Direction (sum_dir)") +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir)))
dat_top <- dat_top[1:10,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
dat <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\partial_deriv.csv')
View(dat)
dat_sum <- dat %>%
group_by(gene) %>%
mutate(sum_dir = sum(direction)) %>%
select(gene, sum_dir) %>%
unique()
View(dat_sum)
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir)))
dat_top <- dat_top[1:10,]
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
p <- ggplot(dat_top, aes(x = reorder(gene, -sum_dir), y = sum_dir)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Lasso.csv')
dat_pca <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Elastic.csv')
View(dat_full)
View(dat_pca)
dat_list <- list(dat_full, dat_pca, dat_elastic)
dat_list
i<-1
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
library(tidyverse)
library(reticulate)
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
View(dat_top)
View(dat)
for(i in 1:length(dat_list)){
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
# dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positively associated" = "darkred", "Negatively associated" = "darkblue")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
for(i in 1:length(dat_list)){
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
# dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positively associated" = "darkred", "Negatively associated" = "darkblue")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(p)
}
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Lasso.csv')
dat_pca <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Elastic.csv')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic)
for(i in 1:length(dat_list)){
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
# dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positively associated" = "darkred", "Negatively associated" = "darkblue")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(p)
}
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Full.csv')
dat_pca <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Elastic.csv')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic)
for(i in 1:length(dat_list)){
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
# dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positively associated" = "darkred", "Negatively associated" = "darkblue")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(p)
}
for(i in 1:length(dat_list)){
# Subset to relevant data
dat <- dat_list[[i]]
# Calculate importance
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
# Add direction
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positively associated", "Negatively associated"))
if(i==1){
dat_top <- dat_top[1:15,]
}
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positively associated" = "darkred", "Negatively associated" = "darkblue")) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(p)
}
library(tidyverse)
library(reticulate)
library(tidytext)
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Full.csv')
dat_full <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Full.csv')
dat_pca <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\partial_deriv_Elastic.csv')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic)
i<-1
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction))
dat <- dat_list[[i]]
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction))
View(dat_sum)
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
View(dat_sum)
View(dat_full)
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
# if (i == 1) {
#   dat_top <- dat_top[1:15, ]
# }
#
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
# Names for the datasets
dataset_names <- c("Full", "PCA", "Elastic")
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(direction)) %>%
select(chem, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
# if (i == 1) {
#   dat_top <- dat_top[1:15, ]
# }
#
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
View(combined_dat)
# Names for the datasets
dataset_names <- c("Full", "PCA", "Elastic")
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(integrated_derivative)) %>%
select(chem, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
# if (i == 1) {
#   dat_top <- dat_top[1:15, ]
# }
#
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic'))
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "darkred", "Negative" = "darkblue")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
# Names for the datasets
dataset_names <- c("Full", "PCA", "Elastic")
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_sum <- dat %>%
group_by(chem) %>%
mutate(sum_dir = sum(integrated_derivative)) %>%
select(chem, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
if (i == 1) {
dat_top <- dat_top[1:15, ]
}
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic'))
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder(chem, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "darkred", "Negative" = "darkblue")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
plot_filename <- paste0('C:/Users/jrchapp3/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/2_Chemical_measurements/pysr/variable_importance_all.png')
ggsave(plot_filename, p, width = 7, height = 4)
library(tidyverse)
dat <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\partial_deriv.csv')
dat <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\partial_deriv.csv')
View(dat)
dat_sum <- dat %>%
group_by(gene) %>%
mutate(sum_dir = sum(integrated_derivative)) %>%
select(gene, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "darkred", "Negative" = "darkblue")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
View(dat_top)
View(dat_sum)
View(dat_sum)
View(dat)
plz <- dat %>%filter(gene == 'Csrnp_1_69505')
View(plz)
unique(plz$equation)
library(tidyverse)
dat <- read.csv('C:\\Users\\jrchapp3\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\partial_deriv.csv')
dat_sum <- dat %>%
group_by(gene) %>%
mutate(sum_dir = sum(integrated_derivative)) %>%
select(gene, sum_dir) %>%
unique()
dat_top <- dat_sum %>%
arrange(desc(abs(sum_dir))) %>%
mutate(Association = ifelse(sum_dir > 0, "Positive", "Negative"))
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -sum_dir), y = sum_dir, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "darkred", "Negative" = "darkblue")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
plot_filename <- paste0('C:/Users/jrchapp3/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/3_Omic_measurements/variable_importance_all.png')
ggsave(plot_filename, p, width = 3.5, height = 4)
library(tidyverse)
library(reticulate)
library(tidytext)
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\variable_importance_Full.csv')
dat_pca <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\variable_importance_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\2_Chemical_measurements\\pysr\\variable_importance_Elastic.csv')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic, dat_albumin)
dat_list <- list(dat_full, dat_pca, dat_elastic)
# Names for the datasets
dataset_names <- c("Full", "PCA", "Elastic")
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_top <- dat%>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
if (i == 1) {
dat_top <- dat_top[1:15, ]
}
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic', 'Albumin'))
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder(chem, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "darkred", "Negative" = "darkblue")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p

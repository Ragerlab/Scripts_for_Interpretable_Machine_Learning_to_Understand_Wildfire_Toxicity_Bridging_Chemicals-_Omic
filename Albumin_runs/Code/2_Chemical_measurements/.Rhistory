cleaned_name
}
})
return(df)
}
# Apply to biospyder IDs
degs_clean <- clean_column_values(degs, "BioSpyder_Identifier")
colnames(degs_clean)[1] <- 'gene'
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene') %>%
select(-gene)
colnames(dat_clean)[2] <- 'gene'
# Add directionality
dat_top <- dat %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset to top 15
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
# Add directionality
dat_top <- dat_clean %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset to top 15
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
View(dat_clean)
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene')
View(dat_clean)
View(degs_clean)
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene') %>%
select(-gene) %>%
unique()
View(dat_clean)
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene') %>%
select(-gene) %>%
unique()
colnames(dat_clean)[2] <- 'gene'
View(dat_clean)
# Add directionality
dat_top <- dat_clean %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset to top 15
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/3_Omic_measurements/variable_importance_all.png')
ggsave(plot_filename, p, width = 3.5, height = 4)
library(tidyverse)
dat <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Albumin_runs\\Models\\3_Omic_measurements\\variable_importance.csv')
degs <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Data_inputs\\3_Omic_measurements\\DEGs.csv') %>%
.[,4:5]
# Rewrite cleaning function from python
clean_column_values <- function(df, column_name) {
df[[column_name]] <- sapply(df[[column_name]], function(name) {
if (name == "S") {
"Sulphur"
} else if (name == "Si") {
"Silicon"
} else {
cleaned_name <- gsub("\\W+", "", name) # Remove non-alphanumeric characters
cleaned_name <- gsub("([a-zA-Z])(\\d)", "\\1_\\2", cleaned_name) # Insert underscore between letters and digits
cleaned_name <- gsub("(\\d)([a-zA-Z])", "\\1_\\2", cleaned_name) # Insert underscore between digits and letters
if (grepl("^[0-9]", cleaned_name)) { # Check if the name starts with a digit
cleaned_name <- paste0("var", cleaned_name)
}
cleaned_name
}
})
return(df)
}
# Apply to biospyder IDs
degs_clean <- clean_column_values(degs, "BioSpyder_Identifier")
colnames(degs_clean)[1] <- 'gene'
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene') %>%
select(-gene) %>%
unique()
colnames(dat_clean)[2] <- 'gene'
# Add directionality
dat_top <- dat_clean %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset to top 15
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/Albumin_runs/images/3_Omic_measurements/variable_importance_all.png')
ggsave(plot_filename, p, width = 3.5, height = 4)
dat <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\rf\\rf_var_importance.csv')
View(dat)
View(dat_clean)
colnames(degs_clean)[2] <- 'Feature'
View(dat_clean)
View(degs_clean)
degs_clean <- clean_column_values(degs, "BioSpyder_Identifier")
View(degs_clean)
colnames(degs_clean)[1] <- 'Feature'
dat_clean <- left_join(dat, degs_clean, by = 'Feature')
View(dat_clean)
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'Feature') %>%
select(-Feature) %>%
unique()
View(dat_clean)
View(degs)
colnames(degs)[1] <- 'Feature'
dat_clean <- left_join(dat, degs_clean, by = 'Feature') %>%
select(-Feature) %>%
unique()
dat_clean <- left_join(dat, degs_clean, by = 'Feature')
View(dat_clean)
View(degs)
View(dat)
dat_clean <- left_join(dat, degs_clean, by = 'Feature')
View(dat_clean)
dat_clean[1,1]
# Merge with data
dat_clean <- left_join(dat, degs, by = 'Feature') %>%
select(-Feature) %>%
unique()
View(dat_clean)
View(dat_clean)
dat <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Models\\3_Omic_measurements\\rf\\rf_var_importance.csv')
# Apply to biospyder IDs
colnames(degs)[1] <- 'Feature'
# Merge with data
dat_clean <- left_join(dat, degs, by = 'Feature') %>%
select(-Feature) %>%
unique()
colnames(dat_clean)[2] <- 'Feature'
# Get top 15 from full
dat_full <- dat_clean %>%
arrange(-Importance) %>%
.[1:15,]
View(dat_full)
dat_all$Dataset <- factor(dat_all$Dataset, levels = c('Full', 'PCA', 'Elastic net'))
p <- ggplot(dat_all, aes(x = reorder_within(Feature, -Importance, Dataset), y = Importance)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Importance") +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ Dataset, scales = "free_x", space = "free") +
scale_x_reordered() +  # Handles the reordered factors
scale_y_continuous(expand = c(0, 0)) +  # This removes the padding between bars and the x-axis
labs(x = 'Chemical')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic)
p <- ggplot(dat_full, aes(x = reorder(Feature, -Importance), y = Importance)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Importance") +
theme_classic()
p
p <- ggplot(dat_full, aes(x = reorder(Feature, -Importance), y = Importance)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Importance") +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
scale_x_reordered() +  # Handles the reordered factors
scale_y_continuous(expand = c(0, 0)) +  # This removes the padding between bars and the x-axis
labs(x = 'Gene')
p
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/2_Chemical_measurements/rf/variable_importance_all.png')
ggsave(plot_filename, p, width = 4, height = 4)
# Plot
p <- ggplot(dat_full, aes(x = reorder(Feature, -Importance), y = Importance)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Importance") +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
scale_x_reordered() +  # Handles the reordered factors
scale_y_continuous(expand = c(0, 0))
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/2_Chemical_measurements/rf/variable_importance_all.png')
ggsave(plot_filename, p, width = 4, height = 4)
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/3_Omic_measurements/rf/variable_importance_all.png')
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/images/3_Omic_measurements/rf/variable_importance_all.png')
ggsave(plot_filename, p, width = 4, height = 4)
library(tidyverse)
library(reticulate)
library(tidytext)
dat_full <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Albumin_runs\\Models\\2_Chemical_measurements\\pysr\\variable_importance_Full.csv')
dat_pca <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Albumin_runs\\Models\\2_Chemical_measurements\\pysr\\variable_importance_PCA.csv')
dat_elastic <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Albumin_runs\\Models\\2_Chemical_measurements\\pysr\\variable_importance_Elastic.csv')
# Put in list
dat_list <- list(dat_full, dat_pca, dat_elastic)
# Names for the datasets
dataset_names <- c("Full", "PCA", "Elastic")
# Combine all data into a single DataFrame with an identifier for each dataset
combined_dat <- do.call(rbind, lapply(1:length(dat_list), function(i) {
dat <- dat_list[[i]]
dat_top <- dat %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset only the top 15 for the first dataset
if (i == 1) {
dat_top <- dat_top[1:15, ]
}
# Add a column indicating the dataset name
dat_top$dataset <- dataset_names[i]
return(dat_top)
}))
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic', 'Albumin'))
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder(chem, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chem", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
# Print the combined plot
print(p)
p
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder_within(chem, -var_importance, dataset), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chemical", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
scale_x_reordered() +  # Add this line to clean up x-axis labels
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/Albumin_runs/images/2_Chemical_measurements/pysr/variable_importance_all.png')
ggsave(plot_filename, p, width = 7, height = 4)
# Subset for presentation
combined_dat <- combined_dat %>%
filter(dataset != 'PCA')
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder_within(chem, -var_importance, dataset), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chemical", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
scale_x_reordered() +  # Add this line to clean up x-axis labels
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem)) %>%
mutate(chem = ifelse(chem == 'var35Dimethoxymethylphenol', '2,6-Dimethoxyphenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic'))
# Subset for presentation
combined_dat <- combined_dat %>%
filter(dataset != 'PCA')
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder_within(chem, -var_importance, dataset), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chemical", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
scale_x_reordered() +  # Add this line to clean up x-axis labels
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem)) %>%
mutate(chem = ifelse(chem == 'var35Dimethoxphenol', '2,6-Dimethoxyphenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic'))
# Subset for presentation
combined_dat <- combined_dat %>%
filter(dataset != 'PCA')
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder_within(chem, -var_importance, dataset), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chemical", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
scale_x_reordered() +  # Add this line to clean up x-axis labels
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
View(combined_dat)
# Clean up names for combined_dat
combined_dat <- combined_dat %>%
mutate(chem = str_remove(chem, pattern = '_')) %>%
mutate(chem = str_remove(chem, pattern = 'var26')) %>%
mutate(chem = ifelse(chem == 'Benzoapyrene', 'Benzo[a]pyrene', chem)) %>%
mutate(chem = ifelse(chem == 'Dimethylnaphthalene', '2,6-Dimethylnaphthalene', chem)) %>%
mutate(chem = ifelse(chem == 'Benzaanthracene', 'Benz(a)anthracene', chem)) %>%
mutate(chem = ifelse(chem == 'Methoxymethylphenol', 'Methoxymethyl phenol', chem)) %>%
mutate(chem = ifelse(chem == 'var35Dimethoxyphenol', '2,6-Dimethoxyphenol', chem))
# Set order
combined_dat$dataset <- factor(combined_dat$dataset, levels = c('Full', 'PCA', 'Elastic'))
# Subset for presentation
combined_dat <- combined_dat %>%
filter(dataset != 'PCA')
# Create the combined plot using facet_wrap and allowing each facet to have its own x-axis
p <- ggplot(combined_dat, aes(x = reorder_within(chem, -var_importance, dataset), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Chemical", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
scale_x_reordered() +  # Add this line to clean up x-axis labels
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
) +
facet_grid(. ~ dataset, scales = "free_x", space = "free") +
labs(x = 'Chemical')
p
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/Albumin_runs/images/2_Chemical_measurements/pysr/variable_importance_all.png')
ggsave(plot_filename, p, width = 7, height = 4)
dat <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Albumin_runs\\Models\\3_Omic_measurements\\variable_importance.csv')
degs <- read.csv('C:\\Users\\Jessie PC\\OneDrive - University of North Carolina at Chapel Hill\\Symbolic_regression_github\\NIH_Cloud_NOSI\\Data_inputs\\3_Omic_measurements\\DEGs.csv') %>%
.[,4:5]
# Rewrite cleaning function from python
clean_column_values <- function(df, column_name) {
df[[column_name]] <- sapply(df[[column_name]], function(name) {
if (name == "S") {
"Sulphur"
} else if (name == "Si") {
"Silicon"
} else {
cleaned_name <- gsub("\\W+", "", name) # Remove non-alphanumeric characters
cleaned_name <- gsub("([a-zA-Z])(\\d)", "\\1_\\2", cleaned_name) # Insert underscore between letters and digits
cleaned_name <- gsub("(\\d)([a-zA-Z])", "\\1_\\2", cleaned_name) # Insert underscore between digits and letters
if (grepl("^[0-9]", cleaned_name)) { # Check if the name starts with a digit
cleaned_name <- paste0("var", cleaned_name)
}
cleaned_name
}
})
return(df)
}
# Apply to biospyder IDs
degs_clean <- clean_column_values(degs, "BioSpyder_Identifier")
colnames(degs_clean)[1] <- 'gene'
# Merge with data
dat_clean <- left_join(dat, degs_clean, by = 'gene') %>%
select(-gene) %>%
unique()
colnames(dat_clean)[2] <- 'gene'
dat_top <- dat_clean %>%
arrange(desc(abs(var_importance))) %>%
mutate(Association = ifelse(var_importance > 0, "Positive", "Negative"))
# Subset to top 15
dat_top <- dat_top[1:15,]
# Create bar chart
p <- ggplot(dat_top, aes(x = reorder(gene, -var_importance), y = var_importance, fill = Association)) +
geom_bar(stat = "identity") +
labs(x = "Gene", y = "Directional importance") +
scale_fill_manual(values = c("Positive" = "grey", "Negative" = "black")) +
theme_classic() +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.position = "bottom"
)
p
# Save
plot_filename <- paste0('C:/Users/Jessie PC/OneDrive - University of North Carolina at Chapel Hill/Symbolic_regression_github/NIH_Cloud_NOSI/Albumin_runs/images/3_Omic_measurements/variable_importance_all.png')
ggsave(plot_filename, p, width = 3.5, height = 4)
